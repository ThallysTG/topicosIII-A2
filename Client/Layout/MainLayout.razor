@inherits LayoutComponentBase
@inject NavigationManager Nav
@using EduMentorClient.Services
@inject UserState UserState

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<div class="min-h-screen bg-[#F5F7FA] flex flex-col font-sans text-[#1F1F1F]">
    
    <nav class="bg-[#0056D2] text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                
                <div class="flex-shrink-0 cursor-pointer flex items-center gap-2" @onclick='() => Nav.NavigateTo("/")'>
                    <span class="font-bold text-xl tracking-wide">EduMentor AI</span>
                </div>

                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-2">
                        
                        @if (UserState.IsLoggedIn)
                        {
                            @if (UserState.Role == "Aluno")
                            {
                                <NavLink href="/" Match="NavLinkMatch.All" class="px-4 py-2 rounded-xl text-sm font-medium hover:bg-[#00419E] transition duration-200" ActiveClass="bg-[#00419E] text-white shadow-inner">Nova Trilha</NavLink>
                                <NavLink href="/my-tracks" class="px-4 py-2 rounded-xl text-sm font-medium hover:bg-[#00419E] transition duration-200" ActiveClass="bg-[#00419E] text-white shadow-inner">Minhas Trilhas</NavLink>
                                <NavLink href="/progress" class="px-4 py-2 rounded-xl text-sm font-medium hover:bg-[#00419E] transition duration-200" ActiveClass="bg-[#00419E] text-white shadow-inner">Progresso</NavLink>
                                <NavLink href="/find-mentors" class="px-4 py-2 rounded-xl text-sm font-medium hover:bg-[#00419E] transition duration-200" ActiveClass="bg-[#00419E] text-white shadow-inner">Mentores</NavLink>
                            }
                            else if (UserState.Role == "Mentor")
                            {
                                <NavLink href="/mentor-dashboard" class="px-4 py-2 rounded-xl text-sm font-medium hover:bg-[#00419E] transition duration-200" ActiveClass="bg-[#00419E] text-white shadow-inner">Painel do Mentor</NavLink>
                            }
                            else if (UserState.Role == "Admin")
                            {
                                <NavLink href="/admin/users" class="px-4 py-2 rounded-xl text-sm font-medium hover:bg-[#00419E] transition duration-200" ActiveClass="bg-[#00419E] text-white shadow-inner">Gestão de Usuários</NavLink>
                            }

                            @if (UserState.Role != "Admin")
                            {
                                <NavLink href="/sessions" class="px-4 py-2 rounded-xl text-sm font-medium hover:bg-[#00419E] transition duration-200" ActiveClass="bg-[#00419E] text-white shadow-inner">Sessões</NavLink>
                            }

                            <button @onclick="Logout" class="ml-6 flex items-center gap-2 bg-[#DC2626] hover:bg-[#B91C1C] text-white px-4 py-2 rounded shadow hover:shadow-md transition duration-200 text-sm font-bold">
                                <span>Sair</span>
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9" />
                                </svg>
                            </button>
                        }
                        else
                        {
                            <NavLink href="/login" class="bg-white text-[#0056D2] hover:bg-gray-100 px-6 py-2 rounded-md text-sm font-bold transition shadow-sm">Entrar</NavLink>
                        }
                    </div>
                </div>
                
                <div class="-mr-2 flex md:hidden">
                    <button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-blue-200 hover:text-white hover:bg-[#00419E] focus:outline-none" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Abrir menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        @Body
    </main>

    <footer class="bg-white border-t border-gray-200 mt-auto py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <div class="text-gray-500 text-sm">
                &copy; 2025 <b>EduMentor AI</b> - Unitins/TO
            </div>
            <div class="text-gray-400 text-xs">
                Powered by Gemini & INEP
            </div>
        </div>
    </footer>

</div>

@code {
    [Inject] Blazored.LocalStorage.ILocalStorageService LocalStorage { get; set; }

    private async Task Logout()
    {
        UserState.Token = string.Empty;
        UserState.UserId = 0;
        UserState.Role = string.Empty;
        
        await LocalStorage.RemoveItemAsync("authToken");
        await LocalStorage.RemoveItemAsync("userId");
        await LocalStorage.RemoveItemAsync("userRole");
        
        Nav.NavigateTo("/login");
    }
}